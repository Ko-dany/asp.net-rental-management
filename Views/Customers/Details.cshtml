@model Midterm_EquipmentRental.Models.Customer
@using Midterm_EquipmentRental.Models

@{
    ViewData["Title"] = "Customer Details";

    string RoleBadgeClass(string role)
        => role?.Trim().Equals("Admin", StringComparison.OrdinalIgnoreCase) == true
            ? "badge rounded-pill bg-danger"
            : "badge rounded-pill bg-primary";

    bool hasHistory = Model?.RentalHistory != null && Model.RentalHistory.Any();
}

<div class="container mt-4">
    <h2 class="mb-4">@ViewData["Title"]</h2>

    <!-- Summary card -->
    <div class="card mb-4" style="max-width: 820px;">
        <div class="card-body">
            <h5 class="card-title mb-3">@Model.Name</h5>

            <div class="mb-2"><strong>ID:</strong> @Model.Id</div>
            <div class="mb-2"><strong>Username:</strong> @Model.UserName</div>
            <div class="mb-2">
                <strong>Role:</strong>
                <span class="@RoleBadgeClass(Model.Role)">@Model.Role</span>
            </div>

            @if(ViewBag.UserRole == UserRole.Admin){
                <a asp-controller="View" asp-action="UpdateCustomer" asp-route-id="@Model.Id" class="btn btn-primary me-2">Edit</a>
                <form asp-controller="View" asp-action="DeleteCustomer" asp-route-id="@Model.Id"
                      method="post" class="d-inline"
                      onsubmit="return confirm('Delete this customer?');">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                </form>
            }
        </div>
    </div>

    <!-- Rental history -->
    <h4 class="mb-3">Rental History</h4>

    @if (!hasHistory)
    {
        <div class="alert alert-info" role="alert" style="max-width: 1200px;">
            This customer has no rental history.
        </div>
    }
    else
    {
        <div class="table-responsive" style="max-width: 1200px;">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Rental ID</th>
                        <th>Equipment ID</th>
                        <th>Issued At</th>
                        <th>Returned At</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var r in Model.RentalHistory)
                {
                    <tr>
                        <td>@r.Id</td>
                        <td>@r.EquipmentId</td>
                        <td>@r.IssuedAt.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>@(r.ReturnedAt == default ? "-" : r.ReturnedAt?.ToString("yyyy-MM-dd HH:mm"))</td>
                            <td>
                                @{
                                    var cls =
                                    r.Status.ToString().Equals("Overdue", StringComparison.OrdinalIgnoreCase) ? "bg-danger" :
                                    r.Status.ToString().Equals("Active", StringComparison.OrdinalIgnoreCase) ? "bg-warning text-dark" :
                                    "bg-success";
                                }
                                <span class="badge rounded-pill @cls">@r.Status</span>
                            </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    }

    <a asp-controller="View" asp-action="GetAllCustomers" class="btn btn-secondary mt-3">Back to List</a>
</div>
